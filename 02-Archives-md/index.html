<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>연구 문서 저장소</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <style>
        /* 1. 전체 페이지에 부드러운 스크롤 적용 */
        html { scroll-behavior: smooth; }
    
        body { display: flex; justify-content: center; background-color: #f6f8fa; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; }
        .container { display: flex; width: 100%; max-width: 1200px; margin: 20px; gap: 20px; }
        
        /* 2. TOC 영역 수정 */
        #toc { 
            width: 250px; 
            position: sticky; 
            top: 20px; 
            /* 화면 높이에서 여백을 뺀 만큼만 최대 높이로 설정 */
            max-height: calc(100vh - 40px); 
            /* 내용이 길어지면 세로 스크롤 생성 */
            overflow-y: auto; 
            padding: 15px; 
            background: white; 
            border: 1px solid #d0d7de; 
            border-radius: 6px; 
            box-sizing: border-box; /* 패딩이 높이에 영향을 주지 않도록 설정 */
        }
    
        /* 3. (선택사항) TOC 스크롤바를 얇고 깔끔하게 디자인 */
        #toc::-webkit-scrollbar { width: 5px; }
        #toc::-webkit-scrollbar-thumb { background-color: #d0d7de; border-radius: 10px; }
        #toc::-webkit-scrollbar-track { background: transparent; }
    
        #toc ul { list-style: none; padding-left: 0; margin-top: 10px; }
        #toc li { margin-bottom: 8px; font-size: 14px; line-height: 1.4; }
        #toc a { text-decoration: none; color: #0969da; }
        #toc a:hover { text-decoration: underline; }
        #toc .depth-1 { font-weight: bold; margin-top: 10px; }
        #toc .depth-2 { padding-left: 12px; color: #57606a; }
        #toc .depth-3 { padding-left: 24px; color: #57606a; font-size: 13px; }
    
        #content { flex: 1; background: white; padding: 45px; border: 1px solid #d0d7de; border-radius: 6px; min-width: 0; }
    </style>
    <script>
	    window.MathJax = {
	        tex: {
	            inlineMath: [['$', '$']], // $ 를 인라인 수식 구분자로 사용
	            displayMath: [['$$', '$$']], // $$ 를 블록 수식 구분자로 사용
	            processEscapes: true
	        },
	        options: {
	            ignoreHtmlClass: 'tex2jax_ignore',
	            processHtmlClass: 'tex2jax_process'
	        }
	    };
	</script>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<div class="container">
    <nav id="toc">
        <strong>목차</strong>
        <ul id="toc-list"></ul>
    </nav>
    <article id="content" class="markdown-body"></article>
</div>

<script>
    const contentEl = document.getElementById('content');
    const tocListEl = document.getElementById('toc-list');

    // 1. 최신 버전에 맞는 Renderer 설정
    const renderer = new marked.Renderer();

    // { text, depth } 객체 형태로 인자를 받도록 수정
    renderer.heading = ({ text, depth }) => {
        // 제목 텍스트에서 특수문자 제거하여 ID 생성
        const id = text.toLowerCase().replace(/[^\w가-힣]+/g, '-');

        // 목차 항목 생성
        if (depth === 1 ) {            
            const li = document.createElement('li');
            li.className = `depth-${depth}`;
            li.innerHTML = `<a href="#${id}">${text}</a>`;
            tocListEl.appendChild(li);
        }
        
        return `<h${depth} id="${id}">${text}</h${depth}>`;
    };

    // marked 설정에 renderer 등록
    marked.setOptions({ renderer: renderer });

    // 2. Fetch 수정: 응답을 텍스트로 변환 후 처리
    fetch('archive-rna.md')
        .then(response => {
            if (!response.ok) throw new Error('파일을 불러올 수 없습니다.');
            return response.text(); // 여기서 Promise를 반환함
        })
        .then(markdownText => {
			// 1. 먼저 마크다운을 HTML로 변환합니다.
		    let htmlContent = marked.parse(markdownText);
		
		    // 2. </strong> 바로 뒤에 한글(가-힣)이 붙어 있는 경우, 그 사이에 제로 너비 공백(&#8203;) 삽입
		    // 정규표현식 설명: </strong> 태그와 한글([가-힣]) 사이를 찾아내어 처리합니다.
		    htmlContent = htmlContent.replace(/<\/strong>([가-힣])/g, '</strong>&#8203;$1');
		    htmlContent = htmlContent.replace(/<\/em>([가-힣])/g, '</em>&#8203;$1');
            // 화면에 출력
            contentEl.innerHTML = htmlContent
			
			if (window.MathJax && window.MathJax.typesetPromise) {
			            window.MathJax.typesetPromise([contentEl]).catch((err) => console.log('MathJax 에러:', err));
	        }
        })
        .catch(err => {
            console.error('에러 발생:', err);
            contentEl.innerHTML = `<p style="color:red;">문서를 불러오는 중 오류가 발생했습니다: ${err.message}</p>`;
        });
</script>
	
</body>
</html>
